<!-- cart.component.html -->
<div class="container py-4">
  <!-- Page Header -->
  <div class="row mb-4">
    <div class="col">
      <h1 class="display-5 fw-bold">Shopping Cart</h1>
      <p class="lead text-muted">Manage your cart and checkout</p>
    </div>
    <div class="col-auto d-flex align-items-center gap-2">
      <button class="btn btn-outline-primary" (click)="onRefresh()" [disabled]="loading()">
        <i class="bi bi-arrow-clockwise me-1"></i> Refresh
      </button>
      <button class="btn btn-primary" (click)="onAddNewCart()">
        <i class="bi bi-plus-lg me-1"></i> New Cart
      </button>
    </div>
  </div>

  <!-- Loading State -->
  @if (loading()) {
  <div class="text-center py-5">
    <div class="spinner-border text-primary mb-3" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="text-muted">Loading carts...</p>
  </div>
  }

  <!-- Error State -->
  @if (error()) {
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
    <i class="bi bi-exclamation-triangle me-2"></i>
    <strong>Error:</strong> {{ error() }}
    <button type="button" class="btn-close" (click)="onRefresh()"></button>
  </div>
  }

  <!-- Empty State -->
  @if (!loading() && carts().length === 0) {
  <div class="alert alert-info text-center py-5">
    <i class="bi bi-bag-x display-1 d-block mb-3"></i>
    <h5>No carts found</h5>
    <p class="mb-3">Start by creating a new cart.</p>
    <button class="btn btn-primary" (click)="onAddNewCart()">
      <i class="bi bi-plus-lg me-1"></i> Create Cart
    </button>
  </div>
  }

  <!-- Main Content -->
  @if (!loading() && carts().length > 0) {
  <div class="row">
    <!-- Carts List Sidebar -->
    <div class="col-md-3 mb-4 mb-md-0">
      <div class="card shadow-sm sticky-top" style="top: 1rem">
        <div class="card-header bg-primary text-white">
          <h6 class="mb-0">
            <i class="bi bi-cart3 me-2"></i> Your Carts
          </h6>
        </div>
        <div class="list-group list-group-flush">
          @for (cart of carts(); track cart.id) {
          <button type="button"
            class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
            [class.active]="selectedCartId() === cart.id" (click)="onSelectCart(cart.id)">
            <div>
              <div class="fw-semibold">Cart #{{ cart.id }}</div>
              <small class="text-muted">User: {{ cart.userId }}</small>
            </div>
            <span class="badge bg-secondary rounded-pill">
              {{ cart.products.length }}
            </span>
          </button>
          }
        </div>
      </div>
    </div>

    <!-- Cart Details -->
    <div class="col-md-9">
      @if (cartLoading()) {
      <div class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading cart...</span>
        </div>
      </div>
      } @else if (currentCart()) {
      <div class="card shadow-sm mb-4">
        <!-- Cart Header -->
        <div class="card-header bg-light d-flex justify-content-between align-items-center">
          <div>
            <h5 class="mb-1">Cart #{{ currentCart()!.id }}</h5>
            <small class="text-muted">
              User ID: {{ currentCart()!.userId }} |
              Date: {{ currentCart()!.date }}
            </small>
          </div>
          <button class="btn btn-sm btn-danger" (click)="onDeleteCart(currentCart()!.id)">
            <i class="bi bi-trash me-1"></i> Delete Cart
          </button>
        </div>

        <!-- Cart Items Table -->
        <div class="table-responsive">
          @if (currentCart()!.products.length > 0) {
          <table class="table table-hover mb-0">
            <thead class="table-light">
              <tr>
                <th>Product ID</th>
                <th>Quantity</th>
                <th class="text-end">Actions</th>
              </tr>
            </thead>
            <tbody>
              @for (item of currentCart()!.products; track item.productId) {
              <tr>
                <td>
                  <strong>{{ item.productId }}</strong>
                </td>
                <td>
                  <div class="input-group input-group-sm" style="width: 100px">
                    <button class="btn btn-outline-secondary" type="button"
                      (click)="onUpdateQuantity(item.productId, item.quantity - 1)" [disabled]="item.quantity <= 1">
                      <i class="bi bi-dash"></i>
                    </button>
                    <input type="number" class="form-control text-center" [value]="item.quantity"
                      (change)="onUpdateQuantity(item.productId, +$event.target.value)" min="1" />
                    <button class="btn btn-outline-secondary" type="button"
                      (click)="onUpdateQuantity(item.productId, item.quantity + 1)">
                      <i class="bi bi-plus"></i>
                    </button>
                  </div>
                </td>
                <td class="text-end">
                  <button class="btn btn-sm btn-outline-danger" (click)="onRemoveProduct(item.productId)"
                    title="Remove from cart">
                    <i class="bi bi-trash"></i>
                  </button>
                </td>
              </tr>
              }
            </tbody>
          </table>
          }
        </div>

        <!-- Empty Cart -->
        @if (currentCart()!.products.length === 0) {
        <div class="card-body text-center py-5">
          <i class="bi bi-bag display-1 text-muted d-block mb-3"></i>
          <p class="text-muted mb-3">Your cart is empty</p>
          <button class="btn btn-primary btn-sm" (click)="onAddProduct(1)">
            <i class="bi bi-plus-lg me-1"></i> Add Sample Product
          </button>
        </div>
        }

        <!-- Cart Footer with Summary -->
        <div class="card-footer bg-light">
          <div class="row align-items-center">
            <div class="col">
              <div class="d-flex align-items-center gap-3">
                <div>
                  <small class="text-muted">Total Items:</small>
                  <div class="h6 mb-0">{{ cartItemCount() }}</div>
                </div>
                <div class="vr"></div>
                <div>
                  <small class="text-muted">Estimated Total:</small>
                  <div class="h6 mb-0">{{ cartTotal() | currency }}</div>
                </div>
              </div>
            </div>
            <div class="col-auto d-flex gap-2">
              @if (currentCart()!.products.length > 0) {
              <button class="btn btn-outline-secondary" (click)="onClearCart()">
                <i class="bi bi-trash me-1"></i> Clear Cart
              </button>
              }
              <button class="btn btn-success">
                <i class="bi bi-lock me-1"></i> Checkout
              </button>
            </div>
          </div>
        </div>
      </div>
      } @else if (!selectedCartId()) {
      <div class="alert alert-info text-center py-5">
        <i class="bi bi-info-circle display-1 d-block mb-3"></i>
        <h5>Select a cart to view details</h5>
        <p class="text-muted">Click on a cart from the list on the left</p>
      </div>
      }
    </div>
  </div>
  }
</div>